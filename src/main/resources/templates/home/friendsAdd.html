<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">

<head th:replace="fragment/header :: commonHeader('Home-Add-Friends - Pay My Buddy')">
    <link rel="stylesheet" href="/css/friends-add.css">
    <title>Friend add </title>
</head>
<body>
    <div th:replace="fragment/header-connected :: connectedHeader"></div>

    <div class="friend-add-form">
        <div class="friend-add-item">
        <label for = "emailInput" class="friend-label">Chercher une relation</label>
        <input  type = "email"
                id = "emailInput"
                placeholder="Saisir une adresse mail"
                class="email-input">
        </div>

        <div class="friend-add-item">
            <button class="add-button" onclick="addFriend()">Ajouter</button>
            <div id="friendAddMessage" class="friend-add-message"></div>
        </div>
    </div>
</body>
</html>

<script>
    async function addFriend() {
        const email = document.getElementById('emailInput').value.trim();
        const messageContainer = document.getElementById('friendAddMessage');
        messageContainer.textContent = '';
        messageContainer.classList.remove('success', 'error');

        if (!email) {
            messageContainer.textContent = "Veuillez saisir une adresse email.";
            messageContainer.classList.add('error');
            return;
        }

        try {
            const response = await fetch(`/users/me/friends/v0?friendEmail=${encodeURIComponent(email)}`, {
                method: 'POST',
                credentials: 'include'
            });
            const text = await response.text();

            if (response.ok) {
                messageContainer.classList.add('success');
                messageContainer.textContent = text;
            } else {
                messageContainer.textContent = "Erreur: " + text;
                messageContainer.classList.add('error');
            }
        }catch (error){
            console.error("Erreur réseau:", err);
            messageContainer.classList.add('error');
            messageContainer.textContent = "Erreur réseau, réessayez.";
        }
    }


</script>